
# chmod

chmod命令用来变更文件或目录的权限。

在UNIX系统家族里，文件或目录权限的控制分别以**读取**、**写入**、**执行**3种一般权限来区分，另有3种特殊权限可供运用。

用户可以使用chmod指令去变更文件与目录的权限，设置方式采用文字或数字代号皆可。

符号连接的权限无法变更，如果用户对符号连接修改权限，其改变会作用在被连接的原始文件。 

## 权限范围

- `u` User，即文件或目录的拥有者； 
- `g` Group，即文件或目录的所属群组； 
- `o` Other，除了文件或目录拥有者或所属群组之外，其他用户皆属于这个范围； 
- `a` All，即全部的用户，包含拥有者，所属群组以及其他用户； 
- `r` 读取权限，数字代号为"**4**"; 
- `w` 写入权限，数字代号为"**2**"； 
- `x` 执行或切换权限，数字代号为"**1**"； 
- `-` 不具任何权限，数字代号为"**0**"； 
- `s` 特殊功能说明：变更文件或目录的权限。


## 选项

- `-R`或`--recursive`：递归处理，将指令目录下的所有文件及子目录一并处理； 
- 
- `-c`或`--changes`：效果类似“-v”参数，但仅回报更改的部分； 
- `-v`或`--verbose`：显示指令执行过程；
- `-f`或`--quiet`或`--silent`：不显示错误信息； 
- `--reference=<参考文件或目录>`：把指定文件或目录的所属群组全部设成和参考文件或目录的所属群组相同； 
- `<权限范围>+<权限设置>`：开启权限范围的文件或目录的该选项权限设置； 
- `<权限范围>-<权限设置>`：关闭权限范围的文件或目录的该选项权限设置； 
- `<权限范围>=<权限设置>`：指定权限范围的文件或目录的该选项权限设置；

## 示例
``` bash
# 设置自己可以执行，组员可以写入的权限 
chmod u+x,g+w file　

# 拥有者设置读写可执行；组设置读写权限；其它用户只读
chmod u=rwx,g=rw,o=r file 

# 拥有者设置读写可执行(4+2+1)；组设置读写权限(4+2)；其它用户只读(4)
chmod 764 file 

# 所有用户设置可执行权限
chmod a+x file　　
```

## 特殊权限

### sticky bit

- **只对目录有效**，使目录下的文件，**只有文件拥有者才能删除**
- 如果他不属于owner，仅属于group或者other，就算他有w权限，也不能删除

加sticky bit的方法：
``` bash
chmod o+t dir
chmod 1777 dir
```

用`ls -l`，可以看到有类似这样的权限：`-rwxrwxrwt`，`t`就代表已经加上了sticky bit，而且**生效了**；如果显示的是`-rwxrwxrwT`，说明也已经加上了sticky bit，但**没有生效**。

### SGID(The Set GroupID )

- 加上SGID的**文件**，表示**运行这个程序时是临时以这个文件的拥有组的身份运行的**；
- 加上SGID的**文件夹**，表示在这个**目录下创建的文件属于目录所在的组**，而**不是创建人所在的组**，在这个目录下创建的目录继承本目录的SGID。

加SGID的方法：
``` bash
chmod g+s file
chmod 2777 file
```

用`ls -l`，可以看到类似这样的权限`drwxrwsrwx`，`s`就代表已经加上了SGID，而且生效，如果显示`drwxrwSrwx`，说明已经加上了SGID，但没有生效（因为本来group就没有执行的权限）。

### SUID(The Set UserID)

SUID与SGID是一样的，惟一不同的是，运行时是以这个文件的拥有者身份来运行。

加SUID的方法：
``` bash
chmod o+s file
chmod 4777 file
```

同样的，加了SUID的文件权限有这类似这两种：`drwsrwxrwx`、`drwSrwxrwx`。

看看passwd命令的权限：`ll /usr/bin/passwd`，是"-rwsr-x-rx"，终于知道为什么执行passwd时，可以修改/etc/shadow文件了吧。
 
 ### 总结
- `SUID`：置于 u 的 x 位，原位置有执行权限，就置为 s，没有了为 S
- `SGID`：置于 g 的 x 位，原位置有执行权限，就置为 s，没有了为 S
- `STICKY`：粘滞位，置于 o 的 x 位，原位置有执行权限，就置为 t ，否则为T



## Read More
> [chmod命令](http://man.linuxde.net/chmod)
> [Linux特殊文件权限(chmod)](http://blog.csdn.net/weiling_shen/article/details/7577571)




